# ã‚ªãƒ¤ãƒ‡ã‚­ ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— & é€²æ—

## å…¨ä½“æ¦‚è¦
è¦ªå­ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ”¯æ´ã™ã‚‹LINEãƒœãƒƒãƒˆã€‚AIã¯ã€Œè§¦åª’ã€ã¨ã—ã¦ä¸‹æ›¸ããƒ»è©±é¡Œã‚¿ãƒãƒ»é€šè©±ãƒ–ãƒªãƒƒã‚¸ã‚’æä¾›ã€‚

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
| é …ç›® | æŠ€è¡“ | çŠ¶æ…‹ |
|------|------|------|
| Webhook/API | Supabase Edge Functions (Deno) | âœ… ç¨¼åƒä¸­ |
| è¨­å®šUI | Deno Fresh â†’ Deno Deploy | ğŸ“ ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ |
| DB | Supabase PostgreSQL + RLS | âœ… ç¨¼åƒä¸­ |
| AI | Gemini 2.5 Flash | âœ… ç¨¼åƒä¸­ |

---

## W0: GASã‚¹ãƒ‘ã‚¤ã‚¯ï¼ˆä»»æ„ï¼‰
> ç›®çš„ï¼šä½“æ„Ÿç¢ºèªã€‚LINEâ†”GASâ†”Geminiç–é€š

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------|------|------|
| æœ€å°å¾€å¾©ã®å‹•ç”»ãƒ»å­¦ã³ã®ãƒ¡ãƒ¢ | â­ï¸ ã‚¹ã‚­ãƒƒãƒ— | ç›´æ¥Supabaseã§å®Ÿè£… |

---

## W1: ç–é€šMVPï¼è¨ˆæ¸¬åœŸå° âœ… å®Œäº†
> Exitï¼šP50 â‰¤3.5sï¼ãƒ­ã‚°è¨˜éŒ²OK

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------|------|------|
| Edgeé–¢æ•°ï¼ˆç½²åæ¤œè¨¼ãƒ»ãƒ‡ãƒ‡ãƒ¥ãƒ¼ãƒ—ãƒ»timeoutãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ | âœ… | ç½²åæ¤œè¨¼ã¯ä¸€æ™‚ç„¡åŠ¹ |
| user_contexts/usage_logs + RLS | âœ… | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ |
| ä¸‹æ›¸ãA/B/Cï¼‹è³ªå•ï¼‹é€šè©±æ–‡ã‚’è¿”ã™ | âœ… | Flex Messageå®Ÿè£… |
| draft_gen/latency_msè¨ˆæ¸¬ | ğŸ”² | ãƒ­ã‚°è¨˜éŒ²æœªå®Ÿè£… |

### W1 æ®‹ä½œæ¥­
- [ ] usage_logsã¸ã®ãƒ­ã‚°è¨˜éŒ²ã‚’æœ‰åŠ¹åŒ–
- [ ] ç½²åæ¤œè¨¼ã‚’æœ¬ç•ªã§æœ‰åŠ¹åŒ–
- [ ] ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·è¨ˆæ¸¬ã®ç¢ºèª

---

## W2: LIFFè¨­å®šï¼ˆç‰¹å¤§UIï¼‰
> Exitï¼šè¨­å®šå¤‰æ›´â†’æ¬¡è¿”ä¿¡ã«åæ˜ 

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------|------|------|
| è¶£å‘³/ãƒˆãƒ¼ãƒ³/NGèª/ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ON-OFF | ğŸ“ | SettingsForm.tsxä½œæˆæ¸ˆã¿ |
| åŒæ„ï¼ˆconsented_atï¼‰ | ğŸ“ | UIã«å®Ÿè£…æ¸ˆã¿ |
| LINEãƒ­ã‚°ã‚¤ãƒ³ç´ä»˜ã‘ï¼ˆline_user_idï¼‰ | ğŸ”² | LIFF SDKé€£æºå¿…è¦ |
| Deno Deployã¸ãƒ‡ãƒ—ãƒ­ã‚¤ | ğŸ”² | æœªå®Ÿæ–½ |
| è¨­å®šåæ˜ ã®å‹•ä½œç¢ºèª | ğŸ”² | æœªå®Ÿæ–½ |

### W2 ã‚¿ã‚¹ã‚¯è©³ç´°
1. LIFFè¨­å®šç”»é¢ã‚’Deno Deployã«ãƒ‡ãƒ—ãƒ­ã‚¤
2. LINE Developersã§LIFFã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­å®š
3. è¨­å®šä¿å­˜â†’Webhookå´ã§èª­ã¿è¾¼ã¿â†’è¿”ä¿¡ã«åæ˜ 

---

## W3: ã‚³ãƒ”ãƒ¼è¨ˆæ¸¬ï¼†"è‡ªä½œ"èª˜å°
> Exitï¼šãƒ†ã‚¹ãƒˆå®¶åº­ã§è‡ªä½œç‡â‰¥30%

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------|------|------|
| è¿”ä¿¡ã‚«ãƒ¼ãƒ‰ã«ã€ŒA/B/Cã‚³ãƒ”ãƒ¼ï¼è‡ªåˆ†ã§æ›¸ãã€ | âœ… | Flex Messageå®Ÿè£…æ¸ˆã¿ |
| draft_gen_copyï¼ˆdraft_id,copy:trueï¼‰è¨˜éŒ² | ğŸ”² | Postbackå‡¦ç†å®Ÿè£…æ¸ˆã¿ã€ãƒ­ã‚°æœªç¢ºèª |
| è‡ªä½œï¼ˆcopy:falseï¼‰ã‚’è¨˜éŒ² | ğŸ”² | åŒä¸Š |
| è‡ªä½œç‡ã®å¯è¦–åŒ– | ğŸ”² | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœªä½œæˆ |

---

## W4: æ•‘æ€¥ç®±Î²ï¼ˆVisionï¼‰
> Exitï¼š10ä»¶ä¸­èª¤æ¡ˆå†…â‰¤1ä»¶ã€æ³¨æ„å–šèµ·100%

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------|------|------|
| ç”»åƒâ†’æ³¨æ„å–šèµ·â†’æœ€å¤§3æ‰‹é † | ğŸ”² | gemini-client.tsã«analyzeImageå®Ÿè£…æ¸ˆã¿ |
| ä½ç¢ºä¿¡ã¯è³ªå•ã®ã¿ | ğŸ”² | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆå¿…è¦ |
| vision_helpãƒ­ã‚°è¨˜éŒ² | ğŸ”² | æœªå®Ÿè£… |

---

## W5: é€šè©±ãƒ–ãƒªãƒƒã‚¸é‹ç”¨
> Exitï¼šé€šè©±èª˜ç™ºå¿œç­”ç‡â‰¥40%

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------|------|------|
| call_suggestç›´å¾Œã®ç¢ºèª | ğŸ”² | é€šè©±èª˜å°æ–‡ã¯è¿”ä¿¡ã«å«ã¾ã‚Œã‚‹ |
| T+6hè¿½è·¡ | ğŸ”² | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œå¿…è¦ |
| LIFFã«ã€Œé€šè©±ã§ããŸã€ãƒœã‚¿ãƒ³ï¼ˆcall_done_self_reportï¼‰ | ğŸ”² | UIæœªå®Ÿè£… |

---

## W6: è¦³æ¸¬ã¨å®‰å®šåŒ–
> Exitï¼šKPIãŒé€±æ¬¡ã§å¯è¦–åŒ–ã€é‹ç”¨æ‰‹é †å®Œæˆ

| ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ | å‚™è€ƒ |
|--------|------|------|
| é€±æ¬¡ãƒ€ãƒƒã‚·ãƒ¥ï¼ˆå¾€å¾©æ•°ãƒ»è‡ªä½œç‡ãƒ»é€šè©±èª˜ç™ºãƒ»P50/P95ï¼‰ | ğŸ”² | |
| ç›£è¦–ï¼ˆSlacké€šçŸ¥ï¼‰ | ğŸ”² | ã‚¨ãƒ©ãƒ¼ç‡>2% or P95>7s |
| é‹ç”¨Runbook | ğŸ”² | |

---

## KPIç›®æ¨™
| æŒ‡æ¨™ | ç›®æ¨™ | ç¾çŠ¶ |
|------|------|------|
| è‡ªä½œç‡ | â‰¥30% | - |
| ã‚³ãƒ”ãƒ¼æ¡ç”¨ç‡ | A/B/Cåˆ†å¸ƒè¨ˆæ¸¬ | - |
| é€šè©±èª˜ç™ºå¿œç­”ç‡ | â‰¥40% | - |
| ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· P50 | â‰¤3.5s | æœªè¨ˆæ¸¬ |
| ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· P95 | â‰¤7s | æœªè¨ˆæ¸¬ |
| æ•‘æ€¥ç®±èª¤æ¡ˆå†… | â‰¤10% | - |

---

## ç’°å¢ƒæƒ…å ±

### Supabase
- Project: `xnzlfpzecupaoilinddx`
- Region: Northeast Asia (Tokyo)
- Dashboard: https://supabase.com/dashboard/project/xnzlfpzecupaoilinddx

### LINE
- LIFF ID: `2008909268-tE6zSm0T`
- Webhook URL: `https://xnzlfpzecupaoilinddx.supabase.co/functions/v1/oyadeki-webhook`

### ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰
```bash
# Supabaseãƒªãƒ³ã‚¯
npx supabase link --project-ref xnzlfpzecupaoilinddx

# Edge Functionãƒ‡ãƒ—ãƒ­ã‚¤
npx supabase functions deploy oyadeki-webhook --no-verify-jwt

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®š
npx supabase secrets set KEY=value
```

---

## å‡¡ä¾‹
- âœ… å®Œäº†
- ğŸ“ ã‚³ãƒ¼ãƒ‰ä½œæˆæ¸ˆã¿ï¼ˆæœªãƒ‡ãƒ—ãƒ­ã‚¤/æœªç¢ºèªï¼‰
- ğŸ”² æœªç€æ‰‹
- â­ï¸ ã‚¹ã‚­ãƒƒãƒ—

---

*æœ€çµ‚æ›´æ–°: 2026-01-16*
