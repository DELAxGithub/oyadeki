# ã‚·ã‚´ãƒ‡ã‚­çµ±åˆãƒ—ãƒ©ãƒ³ (shigodeki â†’ oyadeki)

> v0.1 â€” 2026-02-04 Draft

## 0. æ–¹é‡

ã‚·ã‚´ãƒ‡ã‚­ï¼ˆå®¶æ—å…±æœ‰ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼/TODOï¼‰ã‚’ **åˆ¥ã®iOSã‚¢ãƒ—ãƒªã¨ã—ã¦é–‹ç™ºã›ãš**ã€ã‚ªãƒ¤ãƒ‡ã‚­ã®LINE Bot + LIFFã«çµ±åˆã™ã‚‹ã€‚

**ç†ç”±**:
- è¦ªã«ã¨ã£ã¦ã€ŒLINEã®é€šçŸ¥ã¯è¦‹ã‚‹ã€‚æ–°ã—ã„ã‚¢ãƒ—ãƒªã¯å…¥ã‚Œãªã„ã€
- Supabase + LIFF + LINE Push ã®æ—¢å­˜ã‚¤ãƒ³ãƒ•ãƒ©ãŒãã®ã¾ã¾ä½¿ãˆã‚‹
- å¥‘ç´„å°å¸³ã®æ£šå¸ã—ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ­ã‚°ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…å¯èƒ½

**ã‚³ãƒ³ã‚»ãƒ—ãƒˆä¸Šã®ä½ç½®ã¥ã‘**:
```
ã‚ªãƒ¤ãƒ‡ã‚­ = è¦ªã®æ—¥å¸¸ãƒ‡ã‚¸ã‚¿ãƒ«æ”¯æ´
â”œâ”€â”€ æ•‘æ€¥ç®±        â€¦ å›°ã£ãŸç”»é¢ã‚’è§£æ±º
â”œâ”€â”€ å¥‘ç´„å°å¸³      â€¦ ãŠé‡‘ã®ç®¡ç†
â”œâ”€â”€ ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ­ã‚°   â€¦ è¶£å‘³ã®è¨˜éŒ²
â”œâ”€â”€ å‡ºå“ã‚µãƒãƒ¼ãƒˆ   â€¦ ä¸ç”¨å“ã®æ•´ç†
â””â”€â”€ ã‚·ã‚´ãƒ‡ã‚­       â€¦ ã‚„ã‚‹ã“ã¨ã®ç®¡ç† â† NEW
```

---

## 1. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 1.1 `reminders` ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE reminders (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  line_user_id text NOT NULL,
  group_id text,               -- LINE group_id (NULLãªã‚‰å€‹äºº)
  title text NOT NULL,
  note text,
  due_at timestamptz,          -- æœŸé™ (NULLãªã‚‰æœŸé™ãªã—)
  remind_at timestamptz,       -- é€šçŸ¥äºˆå®šæ™‚åˆ»
  recurrence text DEFAULT 'none'
    CHECK (recurrence IN ('none','daily','weekly','monthly')),
  status text DEFAULT 'pending'
    CHECK (status IN ('pending','completed','snoozed','cancelled')),
  completed_at timestamptz,
  completed_by text,           -- å®Œäº†ã—ãŸäººã® line_user_id
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

CREATE INDEX idx_reminders_line_user ON reminders(line_user_id);
CREATE INDEX idx_reminders_group ON reminders(group_id);
CREATE INDEX idx_reminders_due ON reminders(due_at)
  WHERE status = 'pending';
CREATE INDEX idx_reminders_remind ON reminders(remind_at)
  WHERE status = 'pending' AND remind_at IS NOT NULL;

ALTER TABLE reminders ENABLE ROW LEVEL SECURITY;
```

**è¨­è¨ˆåˆ¤æ–­**:
- `group_id` ã§å®¶æ—å…±æœ‰ã‚’å®Ÿç¾ã€‚LINEã‚°ãƒ«ãƒ¼ãƒ—ã§ã®ç™ºè¨€æ™‚ã«è‡ªå‹•ã‚»ãƒƒãƒˆã•ã‚Œã‚‹
- `remind_at` ã¯ `due_at` ã¨ã¯åˆ¥ã€‚ã€Œæ˜æ—¥15æ™‚æœŸé™ã€ã§ã‚‚ã€Œå½“æ—¥æœ9æ™‚ã«é€šçŸ¥ã€ãŒå¯èƒ½
- `recurrence` ã§ç¹°ã‚Šè¿”ã—ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã«å¯¾å¿œï¼ˆã‚´ãƒŸå‡ºã—ã€è–¬ãªã©ï¼‰
- `completed_by` ã§ã€Œèª°ãŒã‚„ã£ãŸã‹ã€ã‚’è¨˜éŒ²ï¼ˆå®¶æ—å…±æœ‰æ™‚ã«æœ‰ç”¨ï¼‰

### 1.2 `usage_logs` æ‹¡å¼µ

```sql
-- è¿½åŠ ã™ã‚‹ action_type:
'reminder_create'     -- ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ä½œæˆ
'reminder_complete'   -- å®Œäº†
'reminder_snooze'     -- ã‚¹ãƒŒãƒ¼ã‚º
'reminder_list'       -- ä¸€è¦§è¡¨ç¤º
'reminder_notify'     -- é€šçŸ¥é€ä¿¡
```

### 1.3 `upcoming_reminders` ãƒ“ãƒ¥ãƒ¼ï¼ˆé€šçŸ¥ç”¨ï¼‰

```sql
CREATE VIEW upcoming_reminders AS
SELECT
  id, line_user_id, group_id, title, note,
  due_at, remind_at, recurrence
FROM reminders
WHERE status = 'pending'
  AND remind_at IS NOT NULL
  AND remind_at <= now() + interval '5 minutes'
ORDER BY remind_at ASC;
```

---

## 2. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ

### 2.1 ã‚³ãƒãƒ³ãƒ‰ä½“ç³»

| å…¥åŠ› | å‹•ä½œ |
|------|------|
| `ã‚„ã‚‹ã“ã¨` / `TODO` / `ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼` | ä¸€è¦§è¡¨ç¤ºï¼ˆFlex + LIFFãƒªãƒ³ã‚¯ï¼‰ |
| `ã‚„ã‚‹ã“ã¨ ç‰›ä¹³è²·ã† æ˜æ—¥` | AIè§£æâ†’ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ä½œæˆ |
| `ãƒªãƒã‚¤ãƒ³ãƒ‰ é›»æ°—ä»£ 2/10` | AIè§£æâ†’ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ä½œæˆ |
| `ãƒªãƒã‚¤ãƒ³ãƒ‰ ç‡ƒãˆã‚‹ã‚´ãƒŸ æ¯é€±ç«æ›œ` | ç¹°ã‚Šè¿”ã—ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ä½œæˆ |

### 2.2 ä½œæˆãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: "ã‚„ã‚‹ã“ã¨ ç‰›ä¹³è²·ã† æ˜æ—¥ã¾ã§"
    â”‚
    â–¼
Gemini ã§è‡ªç„¶è¨€èªãƒ‘ãƒ¼ã‚¹
    â”‚ â†’ title: "ç‰›ä¹³è²·ã†"
    â”‚ â†’ due_at: 2026-02-05T23:59:00+09:00
    â”‚ â†’ remind_at: 2026-02-05T09:00:00+09:00 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: æœŸé™æ—¥ã®æœ9æ™‚)
    â–¼
ç¢ºèª Flex Message:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ç™»éŒ²       â”‚
â”‚                         â”‚
â”‚ ğŸ“ ç‰›ä¹³è²·ã†              â”‚
â”‚ ğŸ“… æ˜æ—¥ (2/5)           â”‚
â”‚ ğŸ”” 2/5 æœ9æ™‚ã«é€šçŸ¥       â”‚
â”‚                         â”‚
â”‚ [ç™»éŒ²ã™ã‚‹] [æ™‚é–“å¤‰æ›´] [ã‚„ã‚ã‚‹] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼ (postback: action=register_reminder)
reminders ãƒ†ãƒ¼ãƒ–ãƒ«ã« INSERT
    â”‚
    â–¼
"ğŸ“ ã€Œç‰›ä¹³è²·ã†ã€ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼æ˜æ—¥ã®æœãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚"
```

### 2.3 Gemini ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è§£æï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚

ç¾åœ¨æ™‚åˆ»: {now_jst}

JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„:
{
  "title": "ã‚„ã‚‹ã“ã¨å†…å®¹",
  "note": "è£œè¶³ï¼ˆã‚ã‚Œã°ï¼‰",
  "due_at": "ISO8601 (JST)",
  "remind_at": "ISO8601 (JST) â€” æœŸé™ã®æœ9æ™‚ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ",
  "recurrence": "none|daily|weekly|monthly"
}

ãƒ«ãƒ¼ãƒ«:
- ã€Œæ˜æ—¥ã€ã€Œæ¥é€±ã€ã€Œæ¯é€±ç«æ›œã€ç­‰ã®ç›¸å¯¾è¡¨ç¾ã‚’è§£é‡ˆ
- æ™‚åˆ»æŒ‡å®šãŒãªã‘ã‚Œã°æœŸé™ã¯23:59ã€é€šçŸ¥ã¯æœ9:00
- ç¹°ã‚Šè¿”ã—è¡¨ç¾ãŒã‚ã‚Œã° recurrence ã‚’è¨­å®š
- è§£é‡ˆã§ããªã„å ´åˆã¯ title ã®ã¿ã‚»ãƒƒãƒˆã—ä»–ã¯null
```

### 2.4 ä¸€è¦§è¡¨ç¤º

**ã‚³ãƒãƒ³ãƒ‰**: `ã‚„ã‚‹ã“ã¨` / `TODO`

```
â”Œâ”€ Flex Carousel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ç‰›ä¹³è²·ã† â”‚ â”‚é›»æ°—ä»£  â”‚ â”‚ã‚´ãƒŸå‡ºâ”‚ â”‚
â”‚ â”‚æ˜æ—¥     â”‚ â”‚2/10   â”‚ â”‚æ¯é€±ç«â”‚ â”‚
â”‚ â”‚[å®Œäº†]   â”‚ â”‚[å®Œäº†]  â”‚ â”‚[å®Œäº†]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
+ "ğŸ“‹ å…¨ä»¶ã‚’è¦‹ã‚‹" â†’ LIFF ãƒªãƒ³ã‚¯
```

- ç›´è¿‘5ä»¶ã‚’ã‚«ãƒ«ãƒ¼ã‚»ãƒ«è¡¨ç¤º
- å…¨ä»¶ã¯LIFFã§ç®¡ç†

### 2.5 å®Œäº† & ã‚¹ãƒŒãƒ¼ã‚º

**å®Œäº†** (postback: `action=complete_reminder&id={uuid}`):
- `status = 'completed'`, `completed_at = now()`, `completed_by = {userId}`
- ã‚°ãƒ«ãƒ¼ãƒ—ã®å ´åˆ: ã€Œâœ… {title} â€” {userName}ã•ã‚“ãŒå®Œäº†ã—ã¾ã—ãŸã€

**ã‚¹ãƒŒãƒ¼ã‚º** (postback: `action=snooze_reminder&id={uuid}&delay={minutes}`):
- `remind_at` ã‚’å†è¨ˆç®— (1æ™‚é–“å¾Œ / 3æ™‚é–“å¾Œ / æ˜æ—¥æœ)
- ã€Œâ° ã€Œ{title}ã€ã‚’{delay}ã«ã‚‚ã†ä¸€åº¦ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€

### 2.6 ã‚°ãƒ«ãƒ¼ãƒ—å…±æœ‰ã®æŒ™å‹•

| æ“ä½œå ´æ‰€ | group_id | å‹•ä½œ |
|----------|----------|------|
| DM | NULL | å€‹äººãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ |
| ã‚°ãƒ«ãƒ¼ãƒ— | group_id | ã‚°ãƒ«ãƒ¼ãƒ—å…±æœ‰ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ |
| DM ã§ `ã‚„ã‚‹ã“ã¨` | â€” | å€‹äºº + æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—ä¸¡æ–¹ã‚’è¡¨ç¤º |

ã‚°ãƒ«ãƒ¼ãƒ—ã§ä½œæˆ â†’ ã‚°ãƒ«ãƒ¼ãƒ—å…¨å“¡ã«é€šçŸ¥ãŒé£›ã¶ã€‚
å®Œäº† â†’ ã‚°ãƒ«ãƒ¼ãƒ—ã«ã€Œâœ… å®Œäº†ã—ã¾ã—ãŸã€é€šçŸ¥ã€‚

---

## 3. é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

### 3.1 `reminder-notify` Edge Function (Cron)

`weekly-ledger-report` ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã€**5åˆ†ãŠã**ã«å®Ÿè¡Œã€‚

```typescript
// supabase/functions/reminder-notify/index.ts
// Cron: */5 * * * * (5åˆ†ã”ã¨)

1. upcoming_reminders ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰é€šçŸ¥å¯¾è±¡ã‚’å–å¾—
2. å„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã«å¯¾ã—ã¦:
   a. é€šçŸ¥Flex Message ã‚’æ§‹ç¯‰
   b. line_user_id ã¸ Push (å€‹äºº)
   c. group_id ãŒã‚ã‚Œã°ã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚‚ Push
   d. recurrence ãŒ 'none' ã§ãªã‘ã‚Œã°æ¬¡å› remind_at ã‚’è¨ˆç®—ã—ã¦ UPDATE
   e. recurrence ãŒ 'none' ãªã‚‰ remind_at ã‚’ NULL ã« (é€šçŸ¥æ¸ˆã¿ãƒãƒ¼ã‚¯)
3. usage_logs ã« reminder_notify ã‚’è¨˜éŒ²
```

### 3.2 é€šçŸ¥ Flex Message

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”” ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼          â”‚
â”‚                         â”‚
â”‚ ğŸ“ ç‰›ä¹³è²·ã†              â”‚
â”‚ ğŸ“… ä»Šæ—¥ 23:59 ã¾ã§       â”‚
â”‚                         â”‚
â”‚ [å®Œäº†ï¼] [1hå¾Œ] [æ˜æ—¥]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Supabase Cron è¨­å®š

```sql
-- pg_cron (Supabase Dashboard â†’ Database â†’ Extensions)
SELECT cron.schedule(
  'reminder-notify',
  '*/5 * * * *',
  $$ SELECT net.http_post(
    url := 'https://xnzlfpzecupaoilinddx.supabase.co/functions/v1/reminder-notify',
    headers := '{"Authorization": "Bearer SERVICE_ROLE_KEY"}'::jsonb
  ) $$
);
```

---

## 4. LIFF ç”»é¢

### 4.1 ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ä¸€è¦§ `/reminders/[userId]`

æ—¢å­˜ã® `/media/[userId]` ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆ            â”‚
â”‚                             â”‚
â”‚ â”€â”€ ä»Šæ—¥ â”€â”€                   â”‚
â”‚ â˜ ç‰›ä¹³è²·ã†         æœŸé™:ä»Šæ—¥ â”‚
â”‚ â˜ é›»æ°—ä»£æ‰•ã†       æœŸé™:2/10 â”‚
â”‚                             â”‚
â”‚ â”€â”€ ä»Šé€± â”€â”€                   â”‚
â”‚ â˜ ç‡ƒãˆã‚‹ã‚´ãƒŸ     æ¯é€±ç«æ›œ    â”‚
â”‚ â˜ ç—…é™¢äºˆç´„         æœŸé™:2/8  â”‚
â”‚                             â”‚
â”‚ â”€â”€ å®Œäº†æ¸ˆã¿ (2ä»¶) â”€â”€         â”‚
â”‚ â˜‘ éƒµä¾¿å±€          2/3å®Œäº†    â”‚
â”‚ â˜‘ è–¬å—ã‘å–ã‚Š       2/2å®Œäº†    â”‚
â”‚                             â”‚
â”‚ [+ æ–°ã—ã„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ©Ÿèƒ½**:
- ã‚¿ãƒƒãƒ—ã§å®Œäº†/æœªå®Œäº†åˆ‡ã‚Šæ›¿ãˆ
- ã‚¹ãƒ¯ã‚¤ãƒ— or ãƒœã‚¿ãƒ³ã§å‰Šé™¤
- æœŸé™ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ï¼ˆä»Šæ—¥ / ä»Šé€± / ãã‚Œä»¥é™ / æœŸé™ãªã— / å®Œäº†æ¸ˆã¿ï¼‰
- å®Œäº†æ¸ˆã¿ã¯æŠ˜ã‚ŠãŸãŸã¿

### 4.2 API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| Method | Path | èª¬æ˜ |
|--------|------|------|
| GET | `/api/reminders/[userId]` | ä¸€è¦§å–å¾— (status, group_id ãƒ•ã‚£ãƒ«ã‚¿) |
| POST | `/api/reminders` | ä½œæˆ |
| PATCH | `/api/reminders/[id]` | æ›´æ–° (å®Œäº†ã€ã‚¹ãƒŒãƒ¼ã‚ºç­‰) |
| DELETE | `/api/reminders/[id]` | å‰Šé™¤ |

---

## 5. ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤‰æ›´

ç¾åœ¨ã®å³ä¸‹ã€ŒğŸ“² ã‚·ã‚´ãƒ‡ã‚­ã€ã‚’æ´»ç”¨:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‘ å¥‘ç´„å°å¸³   â”‚ ğŸ“– è¦‹ãŸã‚‚ã®   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¬ ç›¸è«‡å±¥æ­´   â”‚ ğŸ“‹ ã‚„ã‚‹ã“ã¨   â”‚  â† ã“ã“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: `message` â†’ ãƒ†ã‚­ã‚¹ãƒˆã€Œã‚„ã‚‹ã“ã¨ã€ã‚’é€ä¿¡ï¼ˆæ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨çµ±ä¸€ï¼‰

---

## 6. ãƒ•ã‚§ãƒ¼ã‚ºåˆ†ã‘

### Phase 1: åŸºæœ¬CRUD (æœ€å°å‹•ä½œ)
> ã‚²ãƒ¼ãƒˆ: ã€Œã‚„ã‚‹ã“ã¨ ã€‡ã€‡ã€ã§ç™»éŒ² â†’ ä¸€è¦§è¡¨ç¤º â†’ å®Œäº†ãŒã§ãã‚‹

| ã‚¿ã‚¹ã‚¯ | è¦‹ç© |
|--------|------|
| `reminders` ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | S |
| Webhook ã«ã‚³ãƒãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ  | M |
| Gemini ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆè‡ªç„¶è¨€èªâ†’JSONï¼‰ | M |
| ä½œæˆç¢ºèª Flex Message | S |
| ä¸€è¦§ã‚«ãƒ«ãƒ¼ã‚»ãƒ« Flex Message | M |
| å®Œäº†/å‰Šé™¤ã® postback ãƒãƒ³ãƒ‰ãƒ© | S |
| `usage_logs` action_type æ‹¡å¼µ | S |

### Phase 2: é€šçŸ¥
> ã‚²ãƒ¼ãƒˆ: æœŸé™å‰ã« LINE Push ãŒå±Šã â†’ ã‚¹ãƒŒãƒ¼ã‚ºã§ãã‚‹

| ã‚¿ã‚¹ã‚¯ | è¦‹ç© |
|--------|------|
| `reminder-notify` Edge Function | M |
| é€šçŸ¥ Flex Message (å®Œäº†/ã‚¹ãƒŒãƒ¼ã‚ºãƒœã‚¿ãƒ³) | S |
| pg_cron è¨­å®š | S |
| ç¹°ã‚Šè¿”ã—ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®æ¬¡å›è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ | M |

### Phase 3: LIFF ç®¡ç†ç”»é¢
> ã‚²ãƒ¼ãƒˆ: LIFF ã§å…¨ä»¶ç®¡ç†ï¼ˆå®Œäº†ã€å‰Šé™¤ã€æ–°è¦ä½œæˆï¼‰ãŒã§ãã‚‹

| ã‚¿ã‚¹ã‚¯ | è¦‹ç© |
|--------|------|
| `/reminders/[userId]` ãƒšãƒ¼ã‚¸ | L |
| `/api/reminders/*` API ãƒ«ãƒ¼ãƒˆ | M |
| RemindersView Island (Preact) | L |

### Phase 4: ã‚°ãƒ«ãƒ¼ãƒ—å…±æœ‰
> ã‚²ãƒ¼ãƒˆ: ã‚°ãƒ«ãƒ¼ãƒ—ã§ä½œæˆã—ãŸãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãŒå®¶æ—å…¨å“¡ã«è¦‹ãˆã‚‹ãƒ»é€šçŸ¥ã•ã‚Œã‚‹

| ã‚¿ã‚¹ã‚¯ | è¦‹ç© |
|--------|------|
| ã‚°ãƒ«ãƒ¼ãƒ—å†…ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ä½œæˆã®åˆ†å² | S |
| ã‚°ãƒ«ãƒ¼ãƒ—é€šçŸ¥ (Push to group) | M |
| å®Œäº†é€šçŸ¥ (ã‚°ãƒ«ãƒ¼ãƒ—å†…å ±å‘Š) | S |
| LIFF ã§å€‹äºº+ã‚°ãƒ«ãƒ¼ãƒ—ã‚’çµ±åˆè¡¨ç¤º | M |

### Phase 5: å°å¸³é€£æºãƒ»ç™ºå±•
> å¥‘ç´„å°å¸³ã¨ã®ç›¸äº’é€£æº

| ã‚¿ã‚¹ã‚¯ | è¦‹ç© |
|--------|------|
| å¥‘ç´„æ›´æ–°æ—¥ â†’ è‡ªå‹•ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ææ¡ˆ | M |
| ã€Œæœªç¢ºèªå°å¸³ã‚ã‚Šã€â†’ ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼åŒ– | S |
| æœã®æ—¥æ¬¡ã‚µãƒãƒªãƒ¼ (ä»Šæ—¥ã®ã‚„ã‚‹ã“ã¨) | M |

---

## 7. æŠ€è¡“çš„ãªæ³¨æ„ç‚¹

### 7.1 3ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- Gemini ã«ã‚ˆã‚‹è‡ªç„¶è¨€èªãƒ‘ãƒ¼ã‚¹ã¯æ—¢å­˜ã® `TIMEOUT_MS = 3000` å†…ã§å®Œäº†ã™ã‚‹å¿…è¦ã‚ã‚Š
- `parseReminder()` ã«ã¯ `thinkingBudget: 0` ã‚’ä½¿ç”¨ï¼ˆ`classifyImageIntent` ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- ãƒ‘ãƒ¼ã‚¹å¤±æ•—æ™‚: ã‚¿ã‚¤ãƒˆãƒ«ã ã‘ä¿å­˜ã—ã€æœŸé™ã¯ã€ŒæœŸé™ã‚’æ•™ãˆã¦ãã ã•ã„ã€ã¨èãè¿”ã™

### 7.2 é€šçŸ¥ã®é »åº¦ç®¡ç†
- ã‚ªãƒ¤ãƒ‡ã‚­ã®ã€Œé™ã‹ãªBotã€æ€æƒ³ã‚’å®ˆã‚‹
- **é€šçŸ¥ã¯æœ€å¤§1æ—¥3å›** (æœ9æ™‚ã®æ—¥æ¬¡ã¾ã¨ã‚ / å€‹åˆ¥ãƒªãƒã‚¤ãƒ³ãƒ‰ / æœŸé™ç›´å‰)
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã§é€šçŸ¥ON/OFFå¯èƒ½ã«ã™ã‚‹ (`user_contexts.reminder_notify_enabled`)

### 7.3 æ—¢å­˜æ©Ÿèƒ½ã¨ã®è¡çªå›é¿
- `sell_items` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆ©ç”¨ã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨ã¯ **ç«¶åˆã—ãªã„** (ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¯1ã‚¿ãƒ¼ãƒ³ã§å®Œçµ)
- ã‚³ãƒãƒ³ãƒ‰ã®å„ªå…ˆé †ä½: å‡ºå“ãƒ¢ãƒ¼ãƒ‰ä¸­ > ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚³ãƒãƒ³ãƒ‰ > é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆ

### 7.4 Gemini ãƒ¢ãƒ‡ãƒ«é¸æŠ
- ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è§£æ: `gemini-2.0-flash` (é€Ÿåº¦é‡è¦–ã€JSONãƒ¢ãƒ¼ãƒ‰)
- æ€è€ƒãƒˆãƒ¼ã‚¯ãƒ³ä¸è¦: `thinkingBudget: 0`

---

## 8. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿ç¯„å›²

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|----------|----------|
| `oyadeki-webhook/index.ts` | ã‚³ãƒãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ ã€postbackãƒãƒ³ãƒ‰ãƒ©è¿½åŠ  |
| `_shared/gemini-client.ts` | `parseReminder()` é–¢æ•°è¿½åŠ  |
| `_shared/supabase-client.ts` | å‹å®šç¾©è¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ï¼‰ |
| `reminder-notify/index.ts` | **æ–°è¦** â€” Croné€šçŸ¥ |
| `liff/routes/reminders/` | **æ–°è¦** â€” LIFFç®¡ç†ç”»é¢ |
| `liff/routes/api/reminders/` | **æ–°è¦** â€” API |
| `liff/islands/RemindersView.tsx` | **æ–°è¦** â€” Island |
| `supabase/migrations/` | **æ–°è¦** â€” reminders ãƒ†ãƒ¼ãƒ–ãƒ« |
| ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»åƒ | å³ä¸‹ã®æ–‡è¨€ãƒ»ã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´ |
| `docs/USER_GUIDE.md` | ã‚·ã‚´ãƒ‡ã‚­â†’ã‚„ã‚‹ã“ã¨ ã®è¨˜è¿°å¤‰æ›´ |

---

## 9. æ¨å¥¨ã™ã‚‹é–‹å§‹é †

**Phase 1 ã‹ã‚‰å§‹ã‚ã‚‹**ã®ãŒè‡ªç„¶ã€‚ç†ç”±:

1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + ã‚³ãƒãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚³ãƒ”ãƒšã§æ¸ˆã‚€
2. é€šçŸ¥ãªã—ã§ã‚‚ã€Œè¨˜éŒ²ã—ã¦ä¸€è¦§è¡¨ç¤ºã€ã ã‘ã§æœ€ä½é™ã®ä¾¡å€¤ãŒã‚ã‚‹
3. ã‚½ãƒ•ãƒˆãƒ­ãƒ¼ãƒ³ãƒä¸­ã®å®¶æ—ãƒ†ã‚¹ãƒˆã§ã€Œé€šçŸ¥ã»ã—ã„ã€ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¾—ã¦ã‹ã‚‰ Phase 2 ã«é€²ã‚ã‚‹

Phase 1 ã®æœ€åˆã®1ã‚³ãƒŸãƒƒãƒˆã§å‹•ãã‚‚ã®ãŒä½œã‚Œã‚‹è¦æ¨¡æ„Ÿã€‚
